<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Industrial DataMatrix Scanner</title>
<link rel="stylesheet" href="style.css">
<link rel="manifest" href="manifest.json">
<script async src="https://docs.opencv.org/4.9.0/opencv.js"></script>
<!-- prefer local zbar-wasm; if not present we try the CDN as fallback -->
<script src="vendor/zbar-wasm/index.min.js"></script>
<script>
  // try to map common export names from the bundled script to `ZBar`
  (function mapZBarGlobal(){
    const map = () => {
      if (typeof ZBar !== 'undefined') return true;
      // common UMD/global names used by builds
      const candidates = [window.zbarWasm, window.zbar_wasm, window.zbar, window.ZBar, window.zbarWasmModule, window.zbarWasm?.default];
      for (const c of candidates) {
        if (typeof c !== 'undefined') {
          window.ZBar = c;
          console.log('ZBar mapped from available global');
          return true;
        }
      }
      return false;
    };

    if (!map()) {
      // fallback: try CDN for @undecaf package (known working build)
      const s = document.createElement('script');
      s.src = 'https://cdn.jsdelivr.net/npm/@undecaf/zbar-wasm@0.11.0/dist/index.js';
      s.onload = () => {
        // attempt mapping again after load
        if (!map()) console.warn('zbar-wasm loaded but global mapping failed');
        else console.log('zbar-wasm loaded from CDN fallback');
      };
      s.onerror = () => console.warn('zbar-wasm not found locally and CDN failed. Place zbar files in vendor/zbar-wasm/');
      document.head.appendChild(s);
    }
  })();
</script>
<!-- ZXing loader (ESM) — tries local vendor then CDN -->
<script type="module" src="zxing-loader.js"></script>
</head>
<body>
<header class="app-header">
  <img id="logo" src="logo.png" alt="Brors.NET Logo">
  <h1>Industrial DataMatrix Scanner</h1>
</header>

<main class="app-content">
  <section class="video-container">
    <video id="video" playsinline></video>
    <canvas id="canvas" aria-hidden="true"></canvas>
  </section>
  <section class="controls">
    <div class="control-row">
      <button id="help-toggle" type="button">Hilfe</button>
      <input id="file-input" type="file" accept="image/*,video/*" />
      <button id="stop-button" type="button">Stopp</button>
    </div>
    <div id="result" class="result">Scan läuft...</div>
  </section>
  <section id="help" class="help hidden">
    <h2>Hilfe</h2>
    <p>Optimierter Open Source DataMatrix Scanner.</p>
    <p>Autor: <b>Joerg@brors.net</b></p>
    <img src="logo.png" width="200" alt="Brors.NET Logo">
  </section>
</main>

<footer class="app-footer">
  &copy; 2026 Brors.NET – alle Rechte vorbehalten.
</footer>

<script src="app.js"></script>
</body>
</html>
